<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="Классическая игра Змейка, написанная на чистом JavaScript."><link rel="shortcut icon" href="./resources/img/Snake.ico" type="image/x-icon"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Snake JS</title><style>@-webkit-keyframes background_rotation{0%,to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}50%{-webkit-transform:rotate(1080deg);transform:rotate(1080deg)}}@keyframes background_rotation{0%,to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}50%{-webkit-transform:rotate(1080deg);transform:rotate(1080deg)}}@-webkit-keyframes foreground_rotation{0%,to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}20%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}40%{-webkit-transform:rotate(45deg);transform:rotate(45deg)}60%{-webkit-transform:rotate(-180deg);transform:rotate(-180deg)}80%{-webkit-transform:rotate(180deg);transform:rotate(180deg)}}@keyframes foreground_rotation{0%,to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}20%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}40%{-webkit-transform:rotate(45deg);transform:rotate(45deg)}60%{-webkit-transform:rotate(-180deg);transform:rotate(-180deg)}80%{-webkit-transform:rotate(180deg);transform:rotate(180deg)}}#footer{width:90%;margin:auto;text-align:center;font-size:12pt}#footer,.forscreen{display:none}@media screen and (max-width:1320px){#footer{display:block}}#sound_switcher_form .sound_items,header{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}header{padding:1% 0;display:-webkit-box;display:-ms-flexbox;display:flex}header .header_div.left,header .header_div.right{-webkit-box-flex:1;-ms-flex:1;flex:1}header .header_div.center{-webkit-box-flex:2;-ms-flex:2;flex:2}#logo{text-shadow:1px 1px 1px #000;position:relative;background:#7a7171;color:#0c0;font-size:26pt;height:60px;width:300px;-webkit-box-shadow:2px 2px;box-shadow:2px 2px;border-radius:19px}#counter_container{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column;flex-flow:column}#counter_container #counter{font-size:26pt;margin:2%}#counter_container #prev_counter{font-size:18pt;margin:0}.by{cursor:pointer;font-size:18pt;text-decoration:none;-webkit-transition:2s;-o-transition:2s;transition:2s;color:#ead8d8}.by:hover{font-size:19pt;font-style:italic}@media screen and (max-width:1200px){#logo{height:50px;width:220px}#counter_container #counter,#logo{font-size:22pt}#counter_container #prev_counter,.by{font-size:14pt}.by:hover{font-size:15pt}}@media screen and (max-width:540px){#logo{height:35px;width:120px}#counter_container #counter{font-size:16pt!important}#counter_container #prev_counter,#logo,.by{font-size:10pt!important}.by:hover{font-size:11pt!important}}@media screen and (max-width:350px){#logo{height:20px;width:70px}#counter_container #counter{font-size:10pt}#counter_container #prev_counter,#logo{font-size:7pt}.by{font-size:5pt}.by:hover{font-size:5.5pt}}@media screen and (max-height:740px){header{padding:0;height:88px}}@media screen and (max-height:451px){header{height:60px}#logo{height:35px;width:120px}#counter_container #counter{font-size:16pt}#counter_container #prev_counter,#logo,.by{font-size:10pt}.by:hover{font-size:11pt}}@media screen and (max-height:350px){#logo{font-size:12pt;height:30px;width:120px}#counter_container #counter{font-size:10pt}#counter_container #prev_counter,.by{font-size:7pt}.by:hover{font-size:8pt}}canvas:hover{cursor:none}@media screen and (max-width:1060px){#game_container,.death_container.active,.pause_container.active,canvas{width:640px;height:502.8572506123px}.img_container img,.img_container::before{width:180px;height:180px}.phrase{text-align:center}.pause_desc,.phrase{font-size:14pt}}@media screen and (max-width:860px){#game_container,.death_container.active,.pause_container.active,canvas{width:540px;height:424.2858052041px}.img_container img,.img_container::before{width:150px;height:150px}.pause_desc,.phrase{text-align:center;font-size:10pt}}@media screen and (max-width:570px){#game_container,.death_container.active,.pause_container.active,canvas{width:340px;height:267.1429143878px}.img_container img,.img_container::before{width:120px;height:120px}.br{display:none}}@media screen and (max-width:360px){#game_container,.death_container.active,.pause_container.active,canvas{width:290px;height:227.8571916837px}.img_container img,.img_container::before{width:100px;height:100px}.pause_desc{text-align:center;font-size:9pt}}@media screen and (max-height:740px){.br{display:none}}@media screen and (max-height:610px){#game_container,.death_container.active,.pause_container.active,canvas{width:440px;height:345.7143597959px}.img_container img,.img_container::before{width:120px;height:120px}.pause_desc,.phrase{font-size:10pt}}@media screen and (max-height:413px){#game_container,.death_container.active,.pause_container.active,canvas{width:390px;height:317.1429143878px}.img_container img,.img_container::before{width:120px;height:120px}}@media screen and (max-height:385px){#game_container,.death_container.active,.pause_container.active,canvas{width:340px;height:267.1429143878px}}@media screen and (max-height:320px){#game_container,.death_container.active,.pause_container.active,canvas{width:290px;height:227.8571916837px}.img_container img,.img_container::before{width:100px;height:100px}}#sound_switcher_form .sound_items{display:-webkit-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%}@media screen and (max-width:1180px){.prop{width:90%;font-size:14pt}.prop span.plus{min-width:30px;min-height:30px}.wrapper form{gap:2%}}@media screen and (max-width:740px){#form_containers{width:60%;margin:0 auto;min-width:185px}#form_containers,.prop{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.prop span{height:50px}.wrapper.active{padding:0}.wrapper form{padding:2%;gap:0}}@media screen and (max-width:460px){#form_containers{width:90%}}@media screen and (max-height:610px){.prop{width:80%}}.form_text{text-align:center}#keys div{width:96%;font-size:18pt;text-align:left}mark{background-color:#9acd32}@media screen and (max-width:1320px){#keys{display:none}}#form_containers,.prop{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}#form_containers{margin-top:3%;height:70%;display:-webkit-box;display:-ms-flexbox;display:flex}#map_switcher_form{display:block!important;overflow:auto!important}.prop{width:80%;margin:0 auto;font-size:18pt;height:auto}.prop span,.prop span .plus{background:#7a7171;color:#ededed!important}.prop,.prop span{display:-webkit-box;display:-ms-flexbox;display:flex}.prop span{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;height:66px;padding:2% 4%;width:100%;border-radius:19px}.prop span .plus{min-width:35px;min-height:35px;background:#564343;border-radius:9px;cursor:pointer}#sound_switcher_form,.prop span,.wrapper{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.wrapper,.wrapper form{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:100%}.wrapper{display:-webkit-box!important;display:-ms-flexbox!important;display:flex!important;background:#847e7e;-ms-flex-flow:wrap;flex-flow:wrap;height:0;padding:0;border-radius:19px;margin:3% auto;-webkit-transition:.8s;-o-transition:.8s;transition:.8s;overflow:hidden}.wrapper form{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;height:100%}.wrapper.active{padding:2% 4%;height:200px}#sound_switcher_form{display:block;overflow:auto}@media screen and (max-width:1180px){.prop{width:90%;font-size:14pt}.prop span.plus{min-width:30px;min-height:30px}.wrapper form{gap:2%}}@media screen and (max-width:740px){#form_containers{width:60%;margin:0 auto;min-width:185px}#form_containers,.prop{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.prop span{height:50px}.wrapper.active{padding:0}.wrapper form{padding:2%;gap:0}}@media screen and (max-width:460px){#form_containers{width:90%}}@media screen and (max-height:610px){.prop{width:80%}}#keys{text-align:center}@media screen and (max-width:1320px){#keys{display:none}}#game_container,canvas{margin:auto;width:840px;height:660px}#game_container{z-index:2;-webkit-box-shadow:0 0 30px 0 #000;box-shadow:0 0 30px 0 #000}canvas{background:green;background-size:cover!important}.death_container,.pause_container{display:none}.death_container.active,.pause_container.active{position:absolute;color:#fff;width:840px;height:660px;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;background:#000;opacity:.7;cursor:pointer;font-size:26pt}.death_container.active p,.pause_container.active p{margin:0}.img_container img,.img_container::before{-webkit-animation:foreground_rotation 20s infinite ease-in-out;animation:foreground_rotation 20s infinite ease-in-out;width:320px;height:320px}.img_container::before{content:" ";position:absolute;background:#fff;border-radius:33%;-webkit-animation:background_rotation 35s infinite ease-in-out;animation:background_rotation 35s infinite ease-in-out}.phrase{font-size:12pt}.pause_desc{font-size:18pt}@media screen and (max-width:1060px){#game_container,.death_container.active,.pause_container.active,canvas{width:640px;height:502.8572506123px}.img_container img,.img_container::before{width:180px;height:180px}.phrase{text-align:center}.pause_desc,.phrase{font-size:14pt}}@media screen and (max-width:860px){#game_container,.death_container.active,.pause_container.active,canvas{width:540px;height:424.2858052041px}.img_container img,.img_container::before{width:150px;height:150px}.pause_desc,.phrase{text-align:center;font-size:10pt}}@media screen and (max-width:570px){#game_container,.death_container.active,.pause_container.active,canvas{width:340px;height:267.1429143878px}.img_container img,.img_container::before{width:120px;height:120px}.br{display:none}}@media screen and (max-width:360px){#game_container,.death_container.active,.pause_container.active,canvas{width:290px;height:227.8571916837px}.img_container img,.img_container::before{width:100px;height:100px}.pause_desc{text-align:center;font-size:9pt}}@media screen and (max-height:740px){.br{display:none}}@media screen and (max-height:610px){#game_container,.death_container.active,.pause_container.active,canvas{width:440px;height:345.7143597959px}.img_container img,.img_container::before{width:120px;height:120px}.pause_desc,.phrase{font-size:10pt}}@media screen and (max-height:413px){#game_container,.death_container.active,.pause_container.active,canvas{width:390px;height:317.1429143878px}.img_container img,.img_container::before{width:120px;height:120px}}@media screen and (max-height:385px){#game_container,.death_container.active,.pause_container.active,canvas{width:340px;height:267.1429143878px}}@media screen and (max-height:320px){#game_container,.death_container.active,.pause_container.active,canvas{width:290px;height:227.8571916837px}.img_container img,.img_container::before{width:100px;height:100px}}.flex{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row wrap;flex-flow:row wrap;gap:2%}.flex .flex_center{-webkit-box-flex:2;-ms-flex:2;flex:2}.flex .flex_left,.flex .flex_right{-webkit-box-flex:1;-ms-flex:1;flex:1}@media screen and (max-width:1320px){.flex_center{margin-right:1%;margin-bottom:2%}}@media screen and (max-width:490px){.flex_center{margin-right:0;-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}.flex_left{-webkit-box-ordinal-group:3;-ms-flex-order:2;order:2}}#counter_container,#logo,.death_container.active,.death_container.active p,.pause_container.active,.pause_container.active p,.prop span .plus,.sound::after,header .header_div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.sound{max-width:60px;height:42px;visibility:hidden;width:100%;position:relative;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer}.sound::after{width:30px;height:30px;top:calc(51% - 15px + 1px)}.sound::before{height:32px;max-height:42px;top:calc(50% - 16px);max-width:60px;border:1px solid #7b6b6b}.sound.on::after{left:calc(100% - 30px + 1px);content:"ON"}.sound::after,.sound::before{display:block;visibility:visible;position:absolute}.sound::after{content:"OFF";background:#fff;border-radius:50%;left:1px;-webkit-transition:.5s;-o-transition:.5s;transition:.5s;text-align:center}.sound::before{content:"";width:100%;background:#7b6b6b;left:0;border-radius:50px;-webkit-box-sizing:content-box;box-sizing:content-box}.sound.on::before{background:#118c4e}.sound.disabled{cursor:default}.sound.disabled::after,.sound.disabled::before{background:#ecdddd}@media screen and (max-width:1180px){.sound{font-size:8pt;max-width:40px;height:32px}.sound::after{width:20px;height:20px;top:calc(51% - 10px + 1px)}.sound::before{height:22px;max-height:32px;top:calc(50% - 11px);max-width:40px;border:1px solid #7b6b6b}.sound.on::after{left:calc(100% - 20px + 1px)}}::-webkit-scrollbar{width:20px}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:#d6dee1;border-radius:20px;border:6px solid transparent;background-clip:content-box}::-webkit-scrollbar-thumb:hover{background-color:#a8bbbf}.tmbs{-webkit-appearance:none;margin:6% auto;width:90%;border-radius:19px}.tmbs::-webkit-slider-runnable-track{height:12px;cursor:pointer;border-radius:19px}.tmbs::-webkit-slider-thumb{-webkit-box-shadow:1px 1px 1px #000;box-shadow:1px 1px 1px #000;border:1px solid #000;height:35px;width:15px;border-radius:40%/20%;background:#dbdada;cursor:pointer;-webkit-appearance:none;margin-top:-14px}.tmbs.red::-webkit-slider-runnable-track{background:-webkit-gradient(linear,left top,right top,from(#000),to(red));background:linear-gradient(90deg,#000 ,red)}.tmbs.green::-webkit-slider-runnable-track{background:-webkit-gradient(linear,left top,right top,from(#000),to(#0f0));background:linear-gradient(90deg,#000 ,#0f0)}.tmbs.blue::-webkit-slider-runnable-track{background:-webkit-gradient(linear,left top,right top,from(#000),to(#00f));background:linear-gradient(90deg,#000 ,#00f)}.tmbs.white::-webkit-slider-runnable-track{background:-webkit-gradient(linear,left top,right top,from(#000),to(#fff));background:linear-gradient(90deg,#000 ,#fff)}@font-face{font-family:"Roboto";src:local("Roboto"),url(./resources/fonts/Roboto-Regular.woff2) format("woff2"),url(./resources/fonts/Roboto-Regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}body{font-family:"Roboto","Arial",sans-serif;margin:0;padding:0;height:100%;max-width:1920px;max-height:1080px;background:#3d3434;color:#ead8d8;cursor:default}</style></head><body><header><div class="header_div left"><p id="logo">Snake Game JS</p></div><div class="header_div center"><div id="counter_container"><p id="counter">Счёт: 0</p><p id="prev_counter"></p></div></div><div class="header_div right"><a class="by" href="https://github.com/EugeneAlWin">@by EugeneAlWin</a></div></header><main class="flex"><div class="flex_left"><div id="form_containers"><div class="prop"><span>Выбрать цвет тела <mark class="plus">+</mark></span><div class="wrapper"><form name="bodyColorSwitcher"><div class="form_text">Тяните ползунки:</div><input type="range" min="0" max="255" name="bodyColorTumb" class="tmbs red" value="240"> <input type="range" min="0" max="255" name="bodyColorTumb" class="tmbs green" value="0"> <input type="range" min="0" max="255" name="bodyColorTumb" class="tmbs blue" value="0"></form></div></div><div class="prop"><span>Выбрать цвет головы <mark class="plus">+</mark></span><div class="wrapper"><form name="headColorSwitcher"><div class="form_text">Тяните ползунки:</div><input type="range" min="0" max="255" name="headColorTumb" class="tmbs red" value="255"> <input type="range" min="0" max="255" name="headColorTumb" class="tmbs green" value="255"> <input type="range" min="0" max="255" name="headColorTumb" class="tmbs blue" value="0"></form></div></div><div class="prop"><span>Настроить скорость <mark class="plus">+</mark></span><div class="wrapper"><form name="speedSwitcher"><div class="form_text">Тяните ползунок:</div><input type="range" min="100" max="300" name="speedTumb" class="tmbs white" value="200"></form></div></div><div class="prop"><span>Выбрать карту <mark class="plus">+</mark></span><div class="wrapper"><form id="map_switcher_form" name="mapSwitcher"><div><input type="radio" value="#008000" name="map" checked="checked"> <label for="map">Трава</label></div><div><input type="radio" value="HDgrass.webp" name="map"> <label for="map">Трава HD</label></div><div><input type="radio" value="#f4a460" name="map"> <label for="map">Песок</label><div><input type="radio" value="HDsand.webp" name="map"> <label for="map">Песок HD</label></div></div><div><input type="radio" value="#00bfff" name="map"> <label for="map">Вода</label></div><div><input type="radio" value="HDwater.webp" name="map"> <label for="map">Вода HD</label></div><div><input type="radio" value="#cf1020" name="map"> <label for="map">Лава</label></div><div><input type="radio" value="HDlava.webp" name="map"> <label for="map">Лава HD</label></div></form></div></div><div class="prop"><span>Настроить звук <mark class="plus">+</mark></span><div class="wrapper"><form name="soundSwitcher" id="sound_switcher_form"><div class="sound_items"><div>Все звуки &nbsp;</div><input id="sound_full" class="sound on" type="checkbox" name="sound" value="full" checked="checked"></div><div class="sound_items"><div>Нажатие клавиш &nbsp;</div><input id="event" class="sound on" type="checkbox" name="sound" value="Event.mp3" checked="checked"></div><div class="sound_items"><div>Рост змейки &nbsp;</div><input id="pickup" class="sound on" type="checkbox" name="sound" value="PickUp.mp3" checked="checked"></div><div class="sound_items"><div>Конец игры &nbsp;</div><input id="gameover" class="sound on" type="checkbox" name="sound" value="GameOver.mp3" checked="checked"></div></form></div></div></div></div><div class="flex_center"><div id="game_container"><div id="pause_container" class="pause_container"><div class="img_container"><img src="./resources/img/Pause.svg" alt="Pause"></div><br class="br"><p class="pause_desc">Игра на паузе. Нажмите на экран или &#171;Пробел&#187;, чтобы продолжить.</p><br class="br"><p class="phrase"></p></div><div id="death_container" class="death_container active"><div class="img_container"><img src="./resources/img/Play.svg" alt="Play"></div><br class="br"><p id="last_count" class="pause_desc">Нажмите на экран или &#171;Ввод&#187;, чтобы начать.</p><br class="br"><p class="phrase"></p></div><canvas id="canvas" width="840" height="660"></canvas><br><br><br></div></div><div id="keys" class="flex_right forkeyboard"><div><p>Кушать круги!</p><mark><q>Пробел</q></mark> - пауза.<br><mark><q>Ввод</q></mark> - старт.<br><mark><q>w a s d</q> </mark>или <mark><q>&uarr; &larr; &darr; &rarr;</q></mark> - управление.<br><mark><q>H</q></mark> - вкл./выкл. звук<br><mark><q>J</q></mark> - вкл./выкл. звук кнопок<br><mark><q>K</q></mark> - вкл./выкл. звук роста<br><mark><q>L</q></mark> - вкл./выкл. звук проигрыша<br><mark><q>1/2/3/4/5</q></mark> - свернуть/развернуть форму<br></div></div></main><footer id="footer"><div class="forkeyboard"><p>Кушать круги!</p><mark><q>Пробел</q></mark> - пауза. <mark><q>Ввод</q></mark> - старт. <mark><q>w a s d</q> </mark>или <mark><q>&uarr; &larr; &darr; &rarr;</q></mark> - управление. <mark><q>H</q></mark> - вкл./выкл. звук. <mark><q>J</q></mark> - вкл./выкл. звук кнопок. <mark><q>K</q></mark> - вкл./выкл. звук роста. <mark><q>L</q></mark> - вкл./выкл. звук проигрыша. <mark><q>1/2/3/4/5</q></mark> - свернуть/развернуть форму.</div><div class="forscreen"><p>Кушать круги!</p><mark><q>Свайп влево/вправо/вверх/вниз</q></mark> - управление. <mark><q>Нажатие</q></mark> - старт. <mark><q>Двойное нажатие</q> - пауза</mark></div></footer><script>class e{posX=0;posY=0;colors=[{color:"red"},{color:"orange"},{color:"blue"},{color:"purple"},{color:"pink"}];constructor(e){this.context=e.canvas.getContext("2d"),this.pixelSize=e.pixelSize,this.worldHeight=e.worldHeight,this.worldWidth=e.worldWidth}DrawApple(e){this.posX=s.getCoordinates(this.worldWidth,this.pixelSize),this.posY=s.getCoordinates(this.worldHeight,this.pixelSize),e&&-1!==e.findIndex((e=>e.posX===this.posX&&e.posY===this.posY))&&this.DrawApple(e),this.context.fillStyle=this.colors[s.getRandomInt(this.colors.length-1)].color,this.context.beginPath(),this.context.arc(this.posX+this.pixelSize/2,this.posY+this.pixelSize/2,this.pixelSize/2-2,0,2*Math.PI),this.context.fill(),this.context.stroke(),this.context.closePath()}Destroy(){this.context.clearRect(this.posX,this.posY,this.pixelSize,this.pixelSize)}CheckAppleCollision(e){for(let t=e.length-1;t>=0;t--)if(0===t){if(e[t].posX===this.posX&&e[t].posY===this.posY)return this.DrawApple(e),!0}else if(e[t].posX===this.posX&&e[t].posY===this.posY)return this.DrawApple(e),!1;return!1}}class t{step=30;dx=this.step;dy=0;frequency=300;timeStart=0;isGamePaused=!1;keys={left:["keya","arrowleft"],right:["keyd","arrowright"],up:["keyw","arrowup"],down:["keys","arrowdown"],space:"space",enter:"enter"};static world;constructor(e){this.keyEventSound=e.keyEventSound,this.InitGame(e)}InitGame(e){t.world=new a({...e,step:this.step,dx:this.dx,dy:this.dy,frequency:this.frequency}),e.pauseContainer.addEventListener("click",(()=>{this.isGamePaused=!this.isGamePaused,t.world.SetPlay()})),e.deathContainer.addEventListener("click",(()=>{this.dy=0,this.dx=this.step,t.world.snake.SetDirection(this.dx,this.dy),t.world.snake.isDead=!1,t.world.deathClassList.remove("active"),t.world.InitWorld()}))}SwitchDirection(e){if(!(new Date-this.timeStart<this.frequency-100)){if(-1!==this.keys.left.indexOf(e))this.dx=-this.step,this.dy=0;else if(-1!==this.keys.right.indexOf(e))this.dx=this.step,this.dy=0;else if(-1!==this.keys.up.indexOf(e))this.dx=0,this.dy=-this.step;else if(-1!==this.keys.down.indexOf(e))this.dx=0,this.dy=this.step;else if(this.keys.space===e){if(t.world.snake.isDead)return;this.isGamePaused=!this.isGamePaused,this.isGamePaused?t.world.SetPause():t.world.SetPlay()}else if(this.keys.enter===e){if(!t.world.snake.isDead)return;this.dy=0,this.dx=this.step,t.world.snake.SetDirection(this.dx,this.dy),t.world.snake.isDead=!1,t.world.deathClassList.remove("active"),t.world.InitWorld()}t.world.PlaySound(this.keyEventSound),t.world.snake.SetDirection(this.dx,this.dy),this.timeStart=new Date}}}class s{constructor(){}static getRandomInt=e=>Math.floor(Math.random()*e);static getCoordinates=(e,t)=>Math.floor(Math.random()*(e/t))*t;static CheckABS=(e,t)=>Math.abs(e)===Math.abs(t)}class i{snakeList=[{posX:60,posY:0},{posX:30,posY:0},{posX:0,posY:0}];snakeOnStart=JSON.stringify(this.snakeList);constructor(e){this.context=e.canvas.getContext("2d"),this.pixelSize=e.pixelSize,this.dx=e.dx,this.dy=e.dy,this.worldWidth=e.worldWidth,this.worldHeight=e.worldHeight,this.bodyColorTumbs=e.bodyColorTumbs,this.headColorTumbs=e.headColorTumbs,this.isDead=!0}DrawSnake(){this.snakeList.forEach(((e,t)=>{if(this.context.clearRect(e.posX,e.posY,this.pixelSize,this.pixelSize),0===t)this.context.fillStyle=this.snakeColor.head,this.prevX=e.posX,this.prevY=e.posY,e.posX+=this.dx,e.posY+=this.dy,e.posX>this.worldWidth-this.pixelSize&&(e.posX=0),e.posX<0&&(e.posX=this.worldWidth-this.pixelSize),e.posY>this.worldHeight-this.pixelSize&&(e.posY=0),e.posY<0&&(e.posY=this.worldHeight-this.pixelSize);else{this.context.fillStyle=this.snakeColor.body;let t=e.posX,s=e.posY;e.posX=this.prevX,e.posY=this.prevY,this.prevX=t,this.prevY=s}this.context.fillRect(e.posX,e.posY,this.pixelSize,this.pixelSize)})),-1!==this.snakeList.slice(1).findIndex((e=>e.posX===this.snakeList[0].posX&&e.posY===this.snakeList[0].posY))&&(this.isDead=!0)}SetDirection(e,t){(!s.CheckABS(this.dx,e)&&!s.CheckABS(this.dy,t)||this.isDead)&&(this.dx=e,this.dy=t)}IncreaseLength(){this.snakeList.push({posX:this.snakeList[this.snakeList.length-1].posX,posY:this.snakeList[this.snakeList.length-1].posY})}SetColor(e=null){this.snakeColor=e??{body:`rgb(${this.bodyColorTumbs[0].value},\n        ${this.bodyColorTumbs[1].value},\n        ${this.bodyColorTumbs[2].value})`,head:`rgb(${this.headColorTumbs[0].value},\n        ${this.headColorTumbs[1].value},\n        ${this.headColorTumbs[2].value})`}}Destroy(){this.snakeList.map((e=>this.context.clearRect(e.posX,e.posY,this.pixelSize,this.pixelSize))),this.snakeList.splice(0),this.snakeList.push(...JSON.parse(this.snakeOnStart))}}class o{static quotes=[{text:"Главное не то, что было будет, а то, что будет было"},{text:"Сначала потом, затем снова опять"},{text:"Глупо рассказывать людям о 狼迹等待着, всё равно не поймут"},{text:"Если тебя съели - у тебя есть два выхода"},{text:"Настоящий отец - мать сын троюродный дед"},{text:"В этой жизни ты либо волк, либо не волк"},{text:"Враги не предают, предают враги"},{text:"Я редко когда думаю, а ещё реже думаю"},{text:"Ауф"},{text:"Папей чаю"},{text:"Легко вставать, когда ты не ложился"},{text:"Иногда жизнь — это жизнь, а ты в ней иногда."},{text:"Если в дверь не постучаться, ее никогда не откроют."},{text:"Тебя зовут по имени, но я зову тебя пить пиво."},{text:"Если тебе тяжело идти, значит ты жирный."},{text:"Сделал дело — дело сделано."},{text:"У батареек есть один минус, и один плюс…"},{text:"Легкой бывает только легкая дорога. Тяжелая дорога всегда трудна."},{text:"Не нужно менять себя ради кого-то, нужно менять носки каждый день, а то они воняют."},{text:"Никогда не поздно, никогда не рано — поменять все поздно, если это рано."},{text:"Я не боюсь ударов в спину, гораздо страшнее, если это моя спина…."},{text:"За двумя зайцами погонишься — рыбку из пруда не выловишь, делу время, а отмеришь семь раз…"}];static quotesGenerator=()=>this.quotes[s.getRandomInt(this.quotes.length)].text}class a{score=0;constructor(t){this.worldHeight=t.canvas.height,this.worldWidth=t.canvas.width,this.pixelSize=Math.round(this.worldWidth/28),this.frequency=t.frequency,this.pauseClassList=t.pauseClassList,this.deathClassList=t.deathClassList,this.quotesContainer=t.quotesContainer,this.scoreContainer=t.scoreContainer,this.lastScore=t.lastScore,this.bestScore=t.bestScore,this.pickAppleSound=t.pickAppleSound,this.deathSound=t.deathSound,this.soundSwitcher=t.soundSwitcher,this.apple=new e({canvas:canvas,pixelSize:this.pixelSize,worldHeight:this.worldHeight,worldWidth:this.worldWidth}),this.snake=new i({canvas:canvas,worldHeight:this.worldHeight,worldWidth:this.worldWidth,pixelSize:this.pixelSize,bodyColorTumbs:t.bodyColorTumbs,headColorTumbs:t.headColorTumbs,step:t.step,dx:t.dx,dy:t.dy}),this.GenerateQuote()}SetInterval(e){this.interval=setInterval((()=>{this.snake.DrawSnake(),this.apple.CheckAppleCollision(this.snake.snakeList)&&(this.snake.IncreaseLength(),this.IncreaseScore(),this.PlaySound(this.pickAppleSound)),this.snake.isDead&&this.GameOver()}),e)}ReSetInterval(e){this.frequency=e,this.interval&&(clearInterval(this.interval),this.SetInterval(this.frequency))}InitWorld(){this.apple.DrawApple(),this.SetInterval(this.frequency)}SetPause(){clearInterval(this.interval),this.pauseClassList.add("active"),this.GenerateQuote()}SetPlay(){this.pauseClassList.remove("active"),this.SetInterval(this.frequency)}GenerateQuote(){this.quotesContainer.forEach((e=>e.innerHTML=o.quotesGenerator()+"<br /> &copy; Волк."))}IncreaseScore(){this.score++,this.scoreContainer.innerText=`Счёт: ${this.score}`}DecreaseScore(){let e=+localStorage.getItem("prev");this.score>e&&(localStorage.setItem("prev",this.score.toString()),e=this.score,this.bestScore.innerText=`Лучший счёт: ${e}`),this.lastScore.innerHTML=`Игра окончена! \n    Ваш счёт: ${this.score}.<br/> \n    Лучший счёт: ${e} <br/>\n    Нажмите на экран или &#171;Ввод&#187;, чтобы начать сначала.`,this.score=0,this.scoreContainer.innerText=`Счёт: ${this.score}`}PlaySound(e){if(!this.soundSwitcher[0].checked)return;const t=e.src.match(/[^\/]+$/)[0];[...this.soundSwitcher].filter((e=>e.value===t))[0].checked&&e.play()}GameOver(){clearInterval(this.interval),this.PlaySound(this.deathSound),this.DecreaseScore(),this.snake.Destroy(),this.apple.Destroy(),this.deathClassList.add("active")}}const r={canvas:document.getElementById("canvas"),bodyColorTumbs:document.forms.bodyColorSwitcher.bodyColorTumb,headColorTumbs:document.forms.headColorSwitcher.headColorTumb,speedTumb:document.forms.speedSwitcher.speedTumb,pauseContainer:document.getElementById("pause_container"),deathContainer:document.getElementById("death_container"),pauseClassList:document.getElementById("pause_container").classList,deathClassList:document.getElementById("death_container").classList,quotesContainer:document.querySelectorAll(".phrase"),scoreContainer:document.getElementById("counter"),lastScore:document.getElementById("last_count"),bestScore:document.getElementById("prev_counter"),soundSwitcher:document.forms.soundSwitcher.sound,keyEventSound:new Audio(`./resources/sounds/${soundSwitcher.event.value}`),pickAppleSound:new Audio(`./resources/sounds/${soundSwitcher.pickup.value}`),deathSound:new Audio(`./resources/sounds/${soundSwitcher.gameover.value}`),formsPluses:[...document.getElementsByClassName("plus")],wrappers:[...document.getElementsByClassName("wrapper")],mapChangeRadios:[...document.forms.mapSwitcher.map],keyboardDiv:document.getElementsByClassName("forkeyboard"),screenDiv:document.getElementsByClassName("forscreen")[0]},n=new t(r);new class{constructor(e,t,s,i){this.tumbsColors=JSON.parse(localStorage.getItem("TumbsColors")),this.headTumbsColors=JSON.parse(localStorage.getItem("headTumbsColors")),this.bgnd=canvas.style.background=localStorage.getItem("Map")??"#008000",this.snakeColor={},this.limit=+e.speedTumb.max+ +e.speedTumb.min,this.setPath=e=>`url("./resources/img/maps/${e}")`,this.soundSwitcher=e.soundSwitcher,this.soundFull=[...e.soundSwitcher].filter((e=>"sound_full"===e.id))[0],this.formsPluses=e.formsPluses,this.wrappers=e.wrappers,this.SwitchSnakeDirection=i,this.keys={keyh:"sound_full",keyj:"event",keyk:"pickup",keyl:"gameover"},this.initEventListeners(e,t,s)}initEventListeners(e,t,s){if(this.initONLoad(e,t,s,this.soundSwitcher),this.initColorChanger(e,t),this.initSpeedChanger(e,s),this.initMapChanger(e),this.initSoundSwitcher(e),this.initFormsWrapper(e),this.isMobile()){this.initTouchListener(e);for(let t=0;t<e.keyboardDiv.length;t++)e.keyboardDiv[t].style="display: none";e.screenDiv.style="display: block",window.innerWidth<window.innerHeight&&this.alertRotate()}else this.initKeyboardListener(e)}initONLoad({bodyColorTumbs:e,headColorTumbs:t,speedTumb:s,mapChangeRadios:i,bestScore:o},a,r,n){document.addEventListener("DOMContentLoaded",(()=>{o.innerText=`Лучший счёт: ${localStorage.getItem("prev")||0}`,e[0].value=this.tumbsColors?.red??240,e[1].value=this.tumbsColors?.green??0,e[2].value=this.tumbsColors?.blue??0,t[0].value=this.headTumbsColors?.red??255,t[1].value=this.headTumbsColors?.green??255,t[2].value=this.headTumbsColors?.blue??0,a(),s.value=localStorage.getItem("Speed")??"200",r(this.limit-+s.value),i.forEach((e=>e.checked=this.bgnd.includes(e.value)));const h=JSON.parse(localStorage.getItem("SoundSwitchers"));h&&n.forEach((e=>{e.checked=h[e.id],e.checked?e.classList.add("on"):e.classList.remove("on"),this.toggleCheckboxes(e)}))}))}initColorChanger({bodyColorTumbs:e,headColorTumbs:t},s){[...e,...t].forEach((i=>{i.addEventListener("input",(()=>{this.snakeColor.body=`rgb(${e[0].value},${e[1].value},${e[2].value})`,this.snakeColor.head=`rgb(${t[0].value},${t[1].value},${t[2].value})`,s(this.snakeColor)})),i.addEventListener("change",(()=>{const s={head:{red:t[0].value,green:t[1].value,blue:t[2].value},body:{red:e[0].value,green:e[1].value,blue:e[2].value}};localStorage.setItem("headTumbsColors",JSON.stringify(s.head)),localStorage.setItem("TumbsColors",JSON.stringify(s.body))}))}))}initSpeedChanger({speedTumb:e},t){e.addEventListener("change",(()=>{t(this.limit-+e.value),localStorage.setItem("Speed",e.value)}))}initMapChanger({mapChangeRadios:e,canvas:t}){e.forEach((e=>{e.addEventListener("change",(()=>{const s=e.value,i=t.style.background=s.includes("#")?s:this.setPath(s);localStorage.setItem("Map",i)}))}))}initSoundSwitcher({soundSwitcher:e}){e.forEach((e=>{e.addEventListener("change",(()=>this.checkboxToggler(e,!1)))}))}initFormsWrapper({formsPluses:e}){e.forEach((e=>{e.addEventListener("click",(e=>{this.toggleActive(e.target,!1)}))}))}initKeyboardListener(){document.addEventListener("keydown",(e=>{let t=e.code.toLowerCase();const s=t.match(/key[w,a,s,d]/)??t.match(/arrow(up|down|left|right)/)??t.match(/space|enter/),i=t.match(/key[h,j,k,l]/),o=t.match(/\$*[1-9]/);(s??i??o)&&this.keyPressDispatcher(s,i,o,e)}))}initTouchListener({canvas:e}){let t=null,s=null,i=Date.now();e.addEventListener("touchstart",(e=>{e.preventDefault(),t=e.touches[0].clientX,s=e.touches[0].clientY,Date.now()-i<200&&this.SwitchSnakeDirection("space"),i=Date.now()})),e.addEventListener("touchmove",(e=>{e.preventDefault(),Math.abs(t-e.touches[0].clientX)>30&&this.SwitchSnakeDirection(t>e.touches[0].clientX?"keya":"keyd"),Math.abs(s-e.touches[0].clientY)>30&&this.SwitchSnakeDirection(s>e.touches[0].clientY?"keyw":"keys")})),e.addEventListener("touchend",(e=>{t=s=null}))}checkboxToggler(e,t=!1){let s=e;if(t&&(s=[...this.soundSwitcher].filter((t=>t.id===this.keys[e]))[0],s.checked=!s.checked),!this.soundFull.checked&&"full"!==s.value)return;s.classList.toggle("on");let i={};this.soundSwitcher.forEach((e=>{i[e.id]=e.checked,this.toggleCheckboxes(e)})),localStorage.setItem("SoundSwitchers",JSON.stringify(i))}toggleCheckboxes(e){this.soundFull.checked||"full"===e.value||(e.classList.add("disabled"),e.disabled=!0),this.soundFull.checked&&"full"!==e.value&&(e.classList.remove("disabled"),e.disabled=!1)}toggleActive(e,t=!1){let s=e;if(t){let t=+e;if(!(t>=1&&t<=9&&t<=this.wrappers.length))return;s=this.formsPluses[--t]}const i=s.parentNode.nextElementSibling.classList;i.contains("active")?(i.remove("active"),s.innerText="+"):(this.wrappers.forEach((e=>e.classList.remove("active"))),this.formsPluses.forEach((e=>e.innerText="+")),i.toggle("active"),s.innerText="+"===s.innerText?"-":"+")}keyPressDispatcher(e,t,s,i){i.preventDefault(),e?this.SwitchSnakeDirection(e[0]):t?this.checkboxToggler(t[0],!0):s&&this.toggleActive(s[0],!0)}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)}alertRotate(){alert("Рекомендую повернуть экран для удобства")}}(r,(()=>t.world.snake.SetColor()),(e=>t.world.ReSetInterval(e)),(e=>n.SwitchDirection(e)));</script></body></html>